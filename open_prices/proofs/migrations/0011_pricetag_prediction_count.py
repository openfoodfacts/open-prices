# Generated by Django 5.1.4 on 2025-02-02 15:15

from django.db import migrations, models


def init_price_tag_prediction_count(apps, schema_editor):
    PriceTag = apps.get_model("proofs", "PriceTag")
    for price_tag in (
        PriceTag.objects.prefetch_related("predictions")
        .annotate(prediction_count_annotated=models.Count("predictions"))
        .filter(prediction_count_annotated__gt=0)
    ):
        price_tag.prediction_count = price_tag.prediction_count_annotated
        price_tag.save(update_fields=["prediction_count"])


class Migration(migrations.Migration):
    dependencies = [
        ("proofs", "0010_proof_prediction_count"),
    ]

    operations = [
        migrations.AddField(
            model_name="pricetag",
            name="prediction_count",
            field=models.PositiveIntegerField(blank=True, default=0, null=True),
        ),
        migrations.RunPython(init_price_tag_prediction_count),
    ]
